<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="apple-mobile-web-app-title" content="USA 2025"/>
<title>USA 2025 Adventure</title>
<style>
:root{
--primary: #FF385C; --primary-light: #FFE8ED; --secondary: #00A699; --success: #34C759;
--text-primary: #1D1D1F; --text-secondary: #6E6E73; --text-tertiary: #8E8E93;
--bg-primary: #FFFFFF; --bg-secondary: #F2F2F7; --surface: #FFFFFF;
--separator: rgba(60,60,67,0.12); --link: #007AFF;
--shadow-sm: 0 1px 3px rgba(0,0,0,0.04); --shadow-md: 0 4px 12px rgba(0,0,0,0.08); --shadow-lg: 0 8px 32px rgba(0,0,0,0.12); --shadow-xl: 0 16px 64px rgba(0,0,0,0.16);
--radius-lg: 16px; --radius-xl: 20px; --radius-2xl: 24px;
--spring: cubic-bezier(0.175, 0.885, 0.32, 1.275); --ease-ios: cubic-bezier(0.25, 0.1, 0.25, 1);
--safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{
font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","Helvetica Neue",Arial,sans-serif;
background:var(--bg-secondary); color:var(--text-primary);
-webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
overflow-x:hidden; padding-top:var(--safe-top);
}
/* ========== Header & Hero ========== */
.status-aware-header{position:sticky; top:0; z-index:1000; background:rgba(255,255,255,0.8); backdrop-filter:saturate(180%) blur(20px); -webkit-backdrop-filter:saturate(180%) blur(20px); border-bottom:0.5px solid var(--separator); padding:8px 20px;}
.nav-container{max-width:1200px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; height:48px;}
.logo{font-size:20px; font-weight:700; color:var(--primary); display:flex; align-items:center; gap:6px;}
.hero{background:var(--bg-primary); padding:32px 20px 40px; text-align:center;}
.hero-title{font-size:clamp(32px, 8vw, 48px); font-weight:800; letter-spacing:-0.02em; line-height:1.1; margin-bottom:8px;}
.hero-subtitle{font-size:18px; font-weight:500; color:var(--text-secondary); margin-bottom:24px;}
.countdown-container{display:flex; justify-content:center; gap:clamp(8px, 2.5vw, 16px); margin-top:24px;}
.countdown-card{background:var(--surface); border:1px solid var(--separator); border-radius:var(--radius-lg); padding:16px 8px; flex:1; text-align:center; box-shadow:var(--shadow-sm); max-width:90px;}
.countdown-value{font-size:clamp(24px, 5vw, 28px); font-weight:800; color:var(--primary); line-height:1; display:block; font-variant-numeric:tabular-nums;}
.countdown-label{font-size:clamp(10px, 2vw, 12px); font-weight:600; color:var(--text-tertiary); text-transform:uppercase; letter-spacing:0.5px; margin-top:4px;}
/* ========== Content Grid & Sections ========== */
.content-grid{display:grid; grid-template-columns: 1fr; gap: 16px; max-width: 1200px; margin: 0 auto; padding: 16px;}
@media (min-width: 1024px) {
.content-grid { grid-template-columns: 2fr 1fr; }
.grid-span-2 { grid-column: span 2; }
}
.content-section{background:var(--bg-primary); border-radius:var(--radius-xl); overflow:hidden; box-shadow:var(--shadow-md);}
.section-header{padding:24px 20px 16px; border-bottom:1px solid var(--separator);}
.section-title{font-size:24px; font-weight:700; color:var(--text-primary); margin-bottom:4px;}
.section-subtitle{font-size:16px; color:var(--text-secondary);}
.section-content{padding:20px;}
/* ========== Road Trip Map (Final Polished Layout) ========== */
.route66{
margin:22px 0;
border:1px solid var(--separator);
border-radius:20px;
background:linear-gradient(90deg, rgba(255,215,0,.08), rgba(88,86,214,.08)), #f6f7fb;
box-shadow:0 12px 28px rgba(16,24,40,.08);
padding:14px 0 18px; /* Remove side padding from main container on all screen sizes */
position:relative;
}
.route66 .section-title{margin-bottom:12px; padding: 0 24px;} /* Add padding to title */
.route66__track{
position: relative;
min-height: 120px;
overflow-x: auto;
-webkit-overflow-scrolling: touch;
scrollbar-width: none;
}
.route66__track::-webkit-scrollbar{ display: none; }
.route66__content-scroller {
position: relative;
width: 150%; /* Make the inner content wider for scrolling */
min-height: 100px;
padding: 0 24px; /* Add padding here for start/end spacing */
}
.route66__road{
position:absolute;left:24px;right:24px;bottom:5px;
height:3px;border-radius:2px;
background:linear-gradient(90deg, var(--primary), var(--secondary));
box-shadow:0 2px 8px rgba(0,0,0,.08);z-index:1;
}
.route66__stops{
display:grid;grid-template-columns:repeat(6,1fr);
gap:clamp(6px,1.8vw,16px);
position:relative;z-index:2;
height: 100%;
}
.route66__stop{
display: flex;
flex-direction: column;
align-items:center;
text-align:center;
justify-content: flex-end;
background:none; border:0; padding:0; cursor: pointer;
}
.route66__date{ font-size:clamp(10px,1.4vw,12px);color:var(--text-tertiary);text-transform:uppercase;letter-spacing:.08em; margin-bottom: 6px;}
.route66__icon{ font-size:clamp(20px,3vw,28px);line-height:1; margin-bottom: 4px; }
.route66__label{ font-size:clamp(12px,1.9vw,14px);font-weight:800;line-height:1.15; margin-bottom: 8px; color: var(--primary); }
.route66__dot{ width:12px;height:12px;border-radius:50%;background:#fff;border:3px solid var(--primary); }
.route66__progress{
position:absolute;bottom:0px;
left: 0; /* Animation will control this */
width:12px;height:12px;border-radius:50%;
background:var(--success);box-shadow:0 0 0 4px rgba(52,199,89,.16);
z-index:3;
animation: r66move 38s linear infinite;
}
.timeline-update {
font-size: 14px;
color: var(--text-secondary);
margin-top: 12px;
}
@keyframes r66move{
0% { left: 24px; }
100% { left: calc(100% - 24px - 6px); }
}
@media (max-width:768px){
.route66__content-scroller { width: 200%; } /* Increase scroll width for mobile */
.route66__label { font-size: 11px; }
.route66__icon { font-size: 20px; }
@keyframes r66move {
0% { left: 24px; }
100% { left: calc(100% - 24px - 6px); } /* Same logic works if applied to the scroller */
}
}
/* ========== Trip Planner (Carousel) ========== */
.trip-planner { padding: 24px; }
.planner-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
.planner-header h2 { font-size: 22px; font-weight: 700; margin-bottom: 0; }
.planner-dots { display: flex; gap: 6px; }
.dot { width: 8px; height: 8px; border-radius: 50%; background: var(--separator); transition: all 0.3s ease; cursor: pointer; }
.dot.active { background: var(--link); transform: scale(1.2); }
.tip-carousel { overflow: hidden; }
.tip-track { display: flex; transition: transform 0.5s var(--ease-ios); }
.tip-slide { flex-shrink: 0; width: 100%; display: flex; align-items: center; gap: 16px; padding-bottom: 4px; }
.tip-icon { font-size: 28px; background: var(--primary-light); color: var(--primary); border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.tip-text h4 { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
.tip-text p { font-size: 14px; color: var(--text-secondary); line-height: 1.4; }
/* ========== Currency Converter ========== */
.currency-converter { padding: 24px; }
.currency-converter h2 { font-size: 22px; font-weight: 700; margin-bottom: 4px; display:flex; align-items:center; gap: 8px;}
.currency-rate { font-size: 28px; font-weight: 800; color: var(--text-primary); margin-bottom: 8px; }
.currency-rate-sub { font-size: 12px; color: var(--text-tertiary); margin-bottom: 16px; }
.currency-inputs { display: flex; gap: 12px; }
.currency-inputs input { flex: 1; padding: 12px; font-size: 16px; border-radius: 12px; border: 1px solid var(--separator); background: var(--bg-secondary); }
.quick-convert-buttons { display: flex; gap: 8px; margin-top: 12px; }
.quick-convert-btn { flex: 1; background: var(--bg-secondary); border: 1px solid var(--separator); padding: 8px; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
.quick-convert-btn:hover { border-color: var(--link); color: var(--link); }
.conversion-result { margin-top: 16px; background: var(--primary-light); color: var(--primary); font-weight: 600; padding: 12px; border-radius: 12px; text-align: center; font-size: 18px; visibility: hidden; opacity: 0; transition: all 0.3s ease; }
.conversion-result.visible { visibility: visible; opacity: 1; }
.currency-chart { height: 60px; margin: 20px 0; }
.currency-chart svg { width: 100%; height: 100%; }
.currency-chart .sparkline { stroke: var(--link); stroke-width: 2.5; fill: none; stroke-linecap: round; stroke-linejoin: round; animation: draw-chart 1s ease-out; }
@keyframes draw-chart { from { stroke-dasharray: 1000; stroke-dashoffset: 1000; } to { stroke-dasharray: 1000; stroke-dashoffset: 0; } }
.action-btn { width: 100%; padding: 16px; font-size: 16px; font-weight: 600; color: #fff; background: var(--link); border: none; border-radius: 12px; cursor: pointer; transition: background 0.2s ease; }
.action-btn:hover { background: #0056b3; }
/* ========== Destinations Hub (Main Component) ========== */
.tabs{display:flex;gap:12px;margin-bottom:24px;overflow-x:auto;flex-wrap:nowrap;padding:4px 20px;margin-left:-20px;margin-right:-20px; scrollbar-width:none;}
.tabs::-webkit-scrollbar{display:none;}
.tab{padding:8px 18px;background:var(--surface);border:1px solid var(--separator);border-radius:30px;font-weight:600;cursor:pointer;transition:all .3s var(--ease-ios); white-space:nowrap; flex-shrink:0; font-size: 15px;}
.tab.active{background:var(--primary);color:#fff;border-color:var(--primary);transform:translateY(-2px);box-shadow:0 8px 16px rgba(255,56,92,.25)}
.tab:hover:not(.active){transform:translateY(-1px);box-shadow:var(--shadow-md)}
.main-card{background:var(--surface);border-radius:var(--radius-xl);overflow:hidden;box-shadow:var(--shadow-lg);display:flex;transition:opacity .4s var(--ease-ios), transform .4s var(--ease-ios);opacity:0;transform:translateY(20px)}
.main-card.visible{opacity:1;transform:translateY(0)}
.hero-image{flex:1;min-height:500px;background-size:cover;background-position:center;position:relative;display:flex;flex-direction:column;justify-content:flex-end;padding:32px;color:#fff}
.hero-image::after{content:"";position:absolute;inset:0;background:linear-gradient(to top,rgba(0,0,0,.7) 0%,rgba(0,0,0,0) 55%)}
.hero-image-title{position:relative;z-index:1;font-size:36px;font-weight:800;line-height:1.2}
.hero-area{position:relative;z-index:1;font-size:18px;font-weight:500;opacity:.95;margin-top:4px}
.content-column{flex:0 0 350px;padding:24px;display:flex;flex-direction:column;gap:24px;max-height:500px;overflow-y:auto; background:var(--bg-secondary);}
.info-item{display:flex;justify-content:space-between;padding:12px 0;border-bottom:1px solid var(--separator);font-size:16px}
.info-item:last-child{border-bottom:none}
.widget{background:var(--surface);border:1px solid var(--separator);box-shadow:var(--shadow-sm);border-radius:var(--radius-lg);padding:20px}
.widget h3{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--text-primary)}
.widget-list{display:grid;gap:12px}
.widget-item{display:flex;gap:14px;padding:12px;border:1px solid var(--separator);border-radius:var(--radius-lg);align-items:center;transition:transform .15s var(--ease-ios),background .15s var(--ease-ios)}
.widget-item:hover{transform:translateY(-2px);background:var(--primary-light)}
.widget-icon{font-size:24px;width:30px;text-align:center}
.widget-text h4{font-size:16px;font-weight:600}
.widget-text p{font-size:14px;color:var(--text-secondary)}
.widget-item.a{cursor:pointer;text-decoration:none;color:inherit}
.weather-main{display:flex;align-items:center;gap:16px;margin-bottom:12px}
.weather-icon{font-size:46px;animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
.weather-temp{font-size:40px;font-weight:800}
.weather-desc{font-size:15px;color:var(--text-secondary)}
/* ========== Moments Section ========== */
.moments-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(260px, 1fr));gap:16px;}
.moment-card{background:var(--surface);border:1px solid var(--separator);border-radius:var(--radius-lg);padding:20px;transition:all 0.2s var(--ease-ios);cursor:pointer;}
.moment-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);border-color:var(--primary);}
.moment-header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.moment-icon{font-size:32px;}
.moment-title{font-size:18px;font-weight:600;}
.moment-description{font-size:14px;color:var(--text-secondary);line-height:1.5;}
/* ========== Journey Hub Styles ========== */
.flights-list{display:grid;gap:16px;}
.flight-card{background:var(--surface);border:1px solid var(--separator);border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-sm); transition: all 0.4s var(--ease-ios);}
.flight-card-content{padding:16px 20px;}
.flight-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;}
.flight-route{font-size:20px;font-weight:700;}
.flight-date{font-size:14px;color:var(--text-secondary);}
.flight-details{display:grid;grid-template-columns:repeat(auto-fit, minmax(100px, 1fr));gap:16px; margin-top: 16px; border-top: 1px solid var(--separator); padding-top: 16px;}
.detail-label{font-size:12px;color:var(--text-tertiary);text-transform:uppercase;margin-bottom:4px;}
.detail-value{font-size:16px;font-weight:600;}
.flight-status{background:rgba(52,199,89,0.15);color:#34C759;font-size:12px;font-weight:600;padding:6px 12px;border-radius:var(--radius-lg);display:inline-block;}
.flight-card.get-ready{border-color:var(--primary); box-shadow:var(--shadow-lg);}
.flight-card.travel-day { border-color:var(--secondary); box-shadow:var(--shadow-xl);}
.flight-card.archived{opacity:0.65; box-shadow:none; border-style: dashed;}
.journey-countdown{text-align:center;padding:12px 0 24px;}
.countdown-title{font-size:12px;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-tertiary);margin-bottom:8px;}
.countdown-time{font-size:32px;font-weight:800;color:var(--secondary);font-variant-numeric:tabular-nums;}
.journey-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:16px;}
.journey-btn{background:var(--bg-secondary);color:var(--text-primary);text-decoration:none;padding:14px;border-radius:var(--radius-lg);font-size:14px;font-weight:600;text-align:center;transition:all 0.2s ease;}
.journey-btn:hover{background:var(--primary-light);color:var(--primary);}
.journey-btn.primary{background:var(--secondary);color:white;}
.journey-btn.primary:hover{background:#007A6D;}
.handoff-welcome{text-align:center;padding:16px 0;}
.handoff-title{font-size:24px; font-weight:700; margin-bottom:4px;}
.handoff-subtitle{font-size:14px; color: var(--text-secondary);}
.handoff-address{background:var(--bg-secondary);border-radius:var(--radius-lg);padding:16px;margin:20px 0;text-align:center;}
.handoff-address strong{display:block;margin-bottom:6px;font-size:16px;}
/* ========== Vegas Birthday Section ========== */
.vegas-birthday {
position: relative;
border-radius: var(--radius-xl);
overflow: hidden;
background: #0A0A0F;
color: #FFFFFF;
padding: 32px 20px;
text-align: center;
box-shadow: var(--shadow-md);
}
.vegas-backdrop {
position: absolute;
inset: 0;
z-index: 1;
background:
radial-gradient(ellipse at 20% 0%, #9D00FF 0%, transparent 40%),
radial-gradient(ellipse at 80% 100%, #FF1493 0%, transparent 40%),
#0A0A0F;
animation: vegasGlow 10s ease-in-out infinite alternate;
}
@keyframes vegasGlow { 0% { opacity: 0.7; } 100% { opacity: 1; } }
.vegas-content { position: relative; z-index: 10; }
.neon-title {
font-size: clamp(36px, 10vw, 64px);
font-weight: 900;
line-height: 1;
background: linear-gradient(45deg, #FFD700, #FF1493, #00F5FF);
background-size: 200% auto;
-webkit-background-clip: text;
-webkit-text-fill-color: transparent;
filter: drop-shadow(0 0 15px #FF1493);
animation: gradientMove 3s linear infinite, neonPulse 2s ease-in-out infinite;
margin-bottom: 8px;
}
@keyframes gradientMove { to { background-position: 200% center; } }
@keyframes neonPulse { 50% { filter: drop-shadow(0 0 25px #FF1493); } }
.vegas-subtitle { font-size: 16px; color: rgba(255, 255, 255, 0.8); margin-bottom: 24px; }
.jackpot-btn {
background: linear-gradient(135deg, #FFD700, #FF6B35);
color: #0A0A0F;
border: none;
border-radius: var(--radius-lg);
padding: 18px 32px;
font-size: 16px;
font-weight: 700;
cursor: pointer;
transition: all 0.3s var(--spring);
box-shadow: 0 8px 32px rgba(255, 215, 0, 0.4);
margin-top: 24px;
}
.jackpot-btn:hover { transform: translateY(-2px) scale(1.02); box-shadow: 0 12px 40px rgba(255, 215, 0, 0.6); }
#vegasConfettiCanvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 999; }
.slot-machine-container { max-height: 0; opacity: 0; overflow: hidden; transition: max-height 0.5s ease-out, opacity 0.5s ease-out, margin-top 0.5s ease-out; }
.slot-machine-container.visible { max-height: 150px; opacity: 1; margin-top: 20px; }
.slot-machine { display: flex; justify-content: center; gap: 12px; padding: 10px; background: linear-gradient(180deg, #1F1F2E, #0A0A0F); border-radius: 16px; border: 2px solid #FFD700; box-shadow: inset 0 0 15px rgba(255, 215, 0, 0.2); }
.slot-reel { width: 80px; height: 100px; background: #151521; border-radius: 10px; border: 1px solid rgba(255, 255, 255, 0.1); overflow: hidden; position: relative; }
.reel-strip span { display: flex; align-items: center; justify-content: center; height: 100px; font-size: 50px; color: #fff; }
.vegas-toast { position: fixed; top: 20px; left: 50%; transform: translate(-50%, -120px); background: rgba(20, 20, 35, 0.9); backdrop-filter: blur(10px); border: 1px solid #FFD700; border-radius: var(--radius-lg); padding: 16px 24px; display: flex; align-items: center; gap: 12px; z-index: 10000; box-shadow: 0 10px 30px rgba(0,0,0,0.4); color: #fff; transition: transform 0.5s var(--spring); }
.vegas-toast.show { transform: translate(-50%, 0); }
/* ========== OVERLAYS & MODALS ========== */
.wx-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);backdrop-filter:blur(10px);opacity:0;pointer-events:none;transition:opacity .35s ease;z-index:2200;display:flex;align-items:center;justify-content:center}
.wx-overlay.show{opacity:1;pointer-events:auto}
.wx-sheet{position:relative;overflow:hidden;color:#fff;border-radius:var(--radius-2xl);box-shadow:0 30px 80px rgba(0,0,0,.4);width:min(500px,94vw);max-height:min(86vh,900px);display:flex;flex-direction:column; transform:scale(0.95); transition:transform 0.3s var(--spring);}
.wx-overlay.show .wx-sheet{transform:scale(1);}
.wx-sunny{background:linear-gradient(135deg,#f6d365,#fda085)}
.wx-cloudy{background:linear-gradient(135deg,#7f8fa6,#718093)}
.wx-rainy{background:linear-gradient(135deg,#74b9ff,#0984e3)}
.wx-close{position:absolute;top:12px;right:12px;border:none;background:rgba(255,255,255,.15);backdrop-filter:blur(6px);color:#fff;border-radius:50%;width:32px;height:32px;cursor:pointer;z-index:10; font-size:16px;}
.wx-top{padding:22px;position:relative}
.weather-animation{position:absolute;inset:0;pointer-events:none}
.rain-drop{position:absolute;width:2px;height:20px;background:rgba(255,255,255,0.6);border-radius:1px;animation:rain 1s linear infinite}
@keyframes rain{0%{transform:translateY(-10px);opacity:0}50%{opacity:1}100%{transform:translateY(60px);opacity:0}}
.wx-city{font-weight:800;letter-spacing:.3px}
.wx-meta{display:flex;align-items:baseline;gap:10px;margin-top:6px}
.wx-temp-lg{font-size:56px;font-weight:900;line-height:1}
.wx-desc-lg{opacity:.95}
.wx-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
.wx-chip{background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.25);border-radius:12px;padding:10px 12px;font-size:14px;display:flex;justify-content:space-between}
.wx-body{background:rgba(0,0,0,.12);backdrop-filter:blur(4px);padding:14px;overflow:auto}
.wx-body h4{font-size:16px;font-weight:600;margin-bottom:8px;opacity:0.9;}
.wx-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px; scrollbar-width:none;}
.wx-row::-webkit-scrollbar{display:none}
.wx-hour{min-width:72px;text-align:center;background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.22);border-radius:12px;padding:10px}
.wx-hour .t{font-weight:800}
.wx-days{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:10px}
.wx-day{background:rgba(255,255,255,.14);border:1px solid rgba(255,255,255,.22);border-radius:12px;padding:10px;text-align:center}
.wx-day .hi{font-weight:800}
.wx-day .lo{opacity:.85}
.concierge-btn{position:fixed;bottom:calc(var(--safe-bottom) + 20px);right:20px;background:var(--primary);color:#fff;border:none;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:var(--shadow-xl);transition:all .3s var(--spring);z-index:1000}
.concierge-btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 12px 40px rgba(255,56,92,.4)}
.concierge-btn .icon{font-size:24px}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .4s ease;z-index:2000}
.modal-overlay.show{opacity:1;pointer-events:auto}
.modal{background:var(--surface);border-radius:var(--radius-xl) var(--radius-xl) 0 0;padding:16px 20px calc(var(--safe-bottom) + 20px);width:100%;max-width:500px;transform:translateY(100%);transition:transform .4s var(--spring)}
.modal-overlay.show .modal{transform:translateY(0)}
.modal-handle{width:36px;height:4px;background:var(--separator);border-radius:2px;margin:0 auto 16px}
.modal-title{font-size:20px;font-weight:600;text-align:center;margin-bottom:16px;}
.quick-actions{display:grid;grid-template-columns:repeat(3, 1fr);gap:14px;}
.quick-action{display:flex;flex-direction:column;align-items:center;padding:16px;background:var(--bg-secondary);border-radius:var(--radius-lg);text-decoration:none;color:inherit;transition:transform .2s var(--ease-ios), background .2s var(--ease-ios)}
.quick-action:hover{transform:translateY(-4px);background:var(--primary-light)}
.quick-action .icon{font-size:28px;margin-bottom:10px}
.quick-action .label{font-weight:600;font-size:14px;text-align:center}
.modal-overlay-custom{position:fixed; inset:0; background:rgba(0,0,0,0.5); backdrop-filter:blur(10px); z-index:2100; display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity 0.3s var(--ease-ios);}
.modal-overlay-custom.show{opacity:1; pointer-events:auto;}
.modal-content-custom{background:var(--surface); border-radius:var(--radius-xl); max-width:600px; width:90%; max-height:85vh; overflow:hidden; display:flex; flex-direction:column; transform:scale(0.95); transition:transform 0.3s var(--spring);}
.modal-overlay-custom.show .modal-content-custom{transform:scale(1);}
.modal-header-custom{padding:16px 20px; border-bottom:1px solid var(--separator); display:flex; justify-content:space-between; align-items:center;}
.modal-title-custom{font-size:20px; font-weight:600;}
.modal-close-btn{background:var(--bg-secondary); border:0; width:32px; height:32px; border-radius:50%; cursor:pointer; font-size:16px; display:flex; align-items:center; justify-content:center;}
.modal-body-custom{padding:20px; overflow-y:auto;}
.modal-list-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg-secondary);border-radius:var(--radius-lg);margin-bottom:8px;}
.modal-item-text strong{display:block;font-size:16px;font-weight:600;}
.modal-item-text span{font-size:14px;color:var(--text-secondary);}
.modal-item-action{background:var(--primary);color:white;text-decoration:none;padding:8px 16px;border-radius:var(--radius-lg);font-size:14px;font-weight:600;}
.live-tip{background:var(--primary-light); border-left: 3px solid var(--primary); padding:12px; border-radius: 8px; margin-top:8px;}
/* ========== MOBILE & RESPONSIVE STYLES ========== */
@media (max-width: 800px){
.main-card{flex-direction:column}
.content-column{max-height:none}
.hero-image{min-height:420px}
}
@media (max-width: 768px) {
.moments-grid {
display: flex;
overflow-x: auto;
flex-wrap: nowrap;
gap: 12px; /* Slightly reduced gap */
margin: 0 -20px;
padding: 4px 20px;
scrollbar-width: none;
scroll-snap-type: x mandatory;
}
.moments-grid::-webkit-scrollbar { display: none; }
.moments-grid .moment-card {
flex-shrink: 0;
width: 75vw; /* UPDATED: Made smaller */
max-width: 290px; /* UPDATED: Capped max width */
scroll-snap-align: start;
}
}
.animate-on-scroll{opacity:0;transform:translateY(20px);transition:all 0.6s var(--ease-ios);}
.animate-on-scroll.visible{opacity:1;transform:translateY(0);}
</style>
</head>
<body>
<header class="status-aware-header">
<div class="nav-container">
<div class="logo">USA 2025 ✈️</div>
</div>
</header>
<section class="hero">
<h1 class="hero-title">Your American Adventure</h1>
<p class="hero-subtitle">September 19 – October 3, 2025 • 15 Days</p>
<div class="countdown-container">
<div class="countdown-card"><span class="countdown-value" id="days">--</span><div class="countdown-label">Days</div></div>
<div class="countdown-card"><span class="countdown-value" id="hours">--</span><div class="countdown-label">Hours</div></div>
<div class="countdown-card"><span class="countdown-value" id="minutes">--</span><div class="countdown-label">Minutes</div></div>
<div class="countdown-card"><span class="countdown-value" id="seconds">--</span><div class="countdown-label">Seconds</div></div>
</div>
</section>
<main class="content-grid">
<section class="route66 animate-on-scroll grid-span-2" id="route-timeline" aria-labelledby="route-title">
<h2 class="section-title" id="route-title">Road Trip Map</h2>
<div class="route66__track" aria-live="polite">
<div class="route66__content-scroller">
<div class="route66__road"></div>
<div class="route66__progress" aria-hidden="true"></div>
<div class="route66__stops">
<button class="route66__stop" onclick="showLocationDetails('sanfran')" aria-label="San Francisco details">
<div class="route66__date">Sep 19–23</div><div class="route66__icon">🌉</div><div class="route66__label">San Francisco</div><div class="route66__dot"></div>
</button>
<button class="route66__stop" onclick="showLocationDetails('yosemite')" aria-label="Yosemite details">
<div class="route66__date">Sep 23–26</div><div class="route66__icon">🏔️</div><div class="route66__label">Yosemite</div><div class="route66__dot"></div>
</button>
<div class="route66__stop" aria-label="Death Valley (pass-through)">
<div class="route66__date">Sep 26</div><div class="route66__icon">🏜️</div><div class="route66__label">Death Valley</div><div class="route66__dot"></div>
</div>
<button class="route66__stop" onclick="showLocationDetails('vegas')" aria-label="Las Vegas details">
<div class="route66__date">Sep 26–Oct 1</div><div class="route66__icon">🎉</div><div class="route66__label">Las Vegas</div><div class="route66__dot"></div>
</button>
<button class="route66__stop" onclick="showMomentDetails('grandCanyon')" aria-label="Grand Canyon guide">
<div class="route66__date">Sep 30</div><div class="route66__icon">🏞️</div><div class="route66__label">Grand Canyon</div><div class="route66__dot"></div>
</button>
<button class="route66__stop" onclick="showLocationDetails('nyc')" aria-label="New York City details">
<div class="route66__date">Oct 1–3</div><div class="route66__icon">🗽</div><div class="route66__label">New York City</div><div class="route66__dot"></div>
</button>
</div>
</div>
</div>
<p class="timeline-update" id="timelineStatus" style="padding: 0 24px;">🛤️ Counting down…</p>
</section>

<section id="destinations-hub" class="content-section animate-on-scroll grid-span-2">
    <div class="section-header">
        <h2 class="section-title">Destinations & Stays</h2>
        <p class="section-subtitle">Your interactive trip itinerary</p>
    </div>
    <div class="section-content">
        <div class="tabs" id="tabs" role="tablist"></div>
        <div class="main-card" id="main-card" aria-live="polite">
          <div class="hero-image" id="hero-image">
            <h2 class="hero-image-title" id="hero-title-text"></h2>
            <p class="hero-area" id="hero-area"></p>
          </div>
          <aside class="content-column" id="content-column"></aside>
        </div>
    </div>
</section>

<section id="dynamic-moments-section" class="content-section animate-on-scroll grid-span-2">
  <div class="section-header">
    <h2 class="section-title">Epic Moments</h2>
    <p class="section-subtitle">Unforgettable experiences planned</p>
  </div>
  <div class="section-content">
    <div class="moments-grid" id="dynamic-moments-grid"></div>
  </div>
</section>

<section id="dynamic-flights-section" class="content-section animate-on-scroll grid-span-2">
    <div class="section-header">
        <h2 class="section-title">Journey Hub</h2>
        <p class="section-subtitle">Your live travel dashboard</p>
    </div>
    <div class="section-content">
        <div class="flights-list" id="dynamic-flights-list"></div>
    </div>
</section>

<div class="content-section trip-planner animate-on-scroll">
    <div class="planner-header">
        <h2>Trip Planner</h2>
        <div class="planner-dots" id="planner-dots"></div>
    </div>
    <div class="tip-carousel">
        <div class="tip-track" id="tip-track">
            <div class="tip-slide">
                <div class="tip-icon">📦</div>
                <div class="tip-text">
                    <h4>Smart Packing Tip</h4>
                    <p>Use packing cubes to separate clothes for different climates (e.g., SF vs. Vegas).</p>
                </div>
            </div>
            <div class="tip-slide">
                <div class="tip-icon">🔌</div>
                <div class="tip-text">
                    <h4>Electronics Ready</h4>
                    <p>Bring a portable power bank. Long days of exploring will drain your battery fast!</p>
                </div>
            </div>
             <div class="tip-slide">
                <div class="tip-icon">💧</div>
                <div class="tip-text">
                    <h4>Stay Hydrated</h4>
                    <p>Carry a reusable water bottle, especially in drier climates like Vegas and Yosemite.</p>
                </div>
            </div>
            <div class="tip-slide">
                <div class="tip-icon">👟</div>
                <div class="tip-text">
                    <h4>Comfort is Key</h4>
                    <p>Pack your most comfortable walking shoes. You'll be covering a lot of ground!</p>
                </div>
            </div>
            <div class="tip-slide">
                <div class="tip-icon">🗺️</div>
                <div class="tip-text">
                    <h4>Offline Access</h4>
                    <p>Download offline maps for areas with poor reception, like national parks.</p>
                </div>
            </div>
            <div class="tip-slide">
                <div class="tip-icon">💳</div>
                <div class="tip-text">
                    <h4>Bank Notification</h4>
                    <p>Notify your bank of your travel dates to avoid any issues with your cards.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="content-section currency-converter animate-on-scroll">
    <h2>🦄 GBP to USD Tracker</h2>
    <div class="currency-rate" id="currency-rate">£1 = $....</div>
    <div class="currency-rate-sub" id="currency-rate-sub">Fetching latest rate...</div>
    <div class="currency-inputs">
        <input type="number" id="currency-input" placeholder="£">
    </div>
    <div class="quick-convert-buttons">
        <button class="quick-convert-btn" data-amount="10">£10</button>
        <button class="quick-convert-btn" data-amount="50">£50</button>
        <button class="quick-convert-btn" data-amount="100">£100</button>
    </div>
    <div class="conversion-result" id="conversion-result"></div>
    <div class="currency-chart">
         <svg viewBox="0 0 300 80" preserveAspectRatio="none">
            <path d="" class="sparkline" id="sparkline-path"></path>
        </svg>
    </div>
    <button class="action-btn">Set Rate Alert</button>
</div>

<section class="vegas-birthday animate-on-scroll grid-span-2">
  <div class="vegas-backdrop"></div>
  <canvas id="vegasConfettiCanvas"></canvas>
  <div class="vegas-content">
    <h2 class="neon-title">DIRTY 30</h2>
    <p class="vegas-subtitle">The Strip • September 28th</p>
    <button class="jackpot-btn" id="jackpotBtn" onclick="playSlots()">🎰 Hit The Jackpot 🎰</button>
    <div class="slot-machine-container" id="slotMachineContainer">
        <div class="slot-machine">
            <div class="slot-reel"><div class="reel-strip" id="reel1"></div></div>
            <div class="slot-reel"><div class="reel-strip" id="reel2"></div></div>
            <div class="slot-reel"><div class="reel-strip" id="reel3"></div></div>
        </div>
    </div>
  </div>
</section>
</main>
<div class="wx-overlay" id="wx-overlay" onclick="toggleWx(false)">
<div class="wx-sheet" id="wx-sheet" onclick="event.stopPropagation()">
<button class="wx-close" onclick="toggleWx(false)">✕</button>
<div class="wx-top">
<div id="wx-anim-detail" class="weather-animation"></div>
<div class="wx-city" id="wx-city"></div><div class="wx-meta"><div class="wx-temp-lg" id="wx-temp-lg"></div><div class="wx-desc-lg" id="wx-desc-lg"></div></div>
<div class="wx-grid">
<div class="wx-chip"><span>Feels like</span><span id="wx-feels"></span></div><div class="wx-chip"><span>Humidity</span><span id="wx-hum"></span></div>
<div class="wx-chip"><span>Wind</span><span id="wx-wind"></span></div><div class="wx-chip"><span>Rain %</span><span id="wx-rain"></span></div>
</div>
</div>
<div class="wx-body">
<h4>Next 8 Hours</h4><div class="wx-row" id="wx-hourly-cards"></div>
<h4 style="margin-top:16px;">Next 3 Days</h4><div class="wx-days" id="wx-days-cards"></div>
</div>
</div>
</div>
<button class="concierge-btn" onclick="toggleConcierge()"><span class="icon">✨</span></button>
<div class="modal-overlay" id="concierge-overlay" onclick="toggleConcierge()">
<div class="modal" onclick="event.stopPropagation()">
<div class="modal-handle"></div>
<div class="modal-title" id="concierge-title"></div>
<div class="quick-actions" id="quick-actions"></div>
</div>
</div>
<div class="modal-overlay-custom" id="modalOverlayCustom" onclick="closeCustomModal()"><div class="modal-content-custom" onclick="event.stopPropagation()"><div class="modal-header-custom"><h2 class="modal-title-custom" id="modalTitleCustom"></h2><button class="modal-close-btn" onclick="closeCustomModal()">✕</button></div><div class="modal-body-custom" id="modalBodyCustom"></div></div></div>
<script>
/* ========== GLOBAL STATE & DATA ========== */
const cities = {
sanfran:{
name:"San Francisco", hero:"https://images.unsplash.com/photo-1501594907352-04cda38ebc29?q=80&w=2064&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", dates:"19–23 Sep", area:"Union Square", lat:37.7749, lon:-122.4194,
stay:{ address:"123 Union Square Plaza, San Francisco, CA 94108", mapsLink:"https://www.google.com/maps/search/?api=1&query=Union+Square+San+Francisco" },
food:[
{icon:"🍞", name:"Boudin Bakery", desc:"Sourdough bowls at the Wharf.", url:"https://www.google.com/maps/search/?api=1&query=Boudin+Bakery+Fisherman%27s+Wharf"},
{icon:"🥗", name:"Greens Restaurant", desc:"Iconic vegetarian dining with views.", url:"https://www.google.com/maps/search/?api=1&query=Greens+Restaurant+Fort+Mason", veg:true},
{icon:"🌯", name:"La Taqueria", desc:"Authentic Mission-style burritos.", url:"https://www.google.com/maps/search/?api=1&query=La+Taqueria+San+Francisco"},
{icon:"🍫", name:"Ghirardelli Square", desc:"World-famous chocolate & sundaes.", url:"https://www.google.com/maps/search/?api=1&query=Ghirardelli+Square"}
],
moments:[
{id:"ggSunrise", icon:"🌉", title:"Golden Gate Sunrise", description:"First light at Battery Spencer. Have layers ready for the wind."},
{id:"alcatraz", icon:"⛓️", title:"Alcatraz Island Tour", description:"Explore the infamous prison."},
{id:"cableCar", icon:"🚃", title:"Ride a Cable Car", description:"Climb the hills of SF."},
{id:"muirWoods", icon:"🌲", title:"Walk with Giants", description:"Visit the majestic redwood forest at Muir Woods."}
],
flights:[ { id: "flight01", route:"LON → SFO", airline: "British Airways", number:"BA 285", status:"Booked", departureTime: "2025-09-19T11:15:00-00:00", arrivalTime: "2025-09-19T14:10:00-07:00", checkinURL: "https://www.britishairways.com/travel/olci/public/en_gb" } ],
concierge:[ {icon:"🗺️", label:"Maps", url:"https://www.google.com/maps/search/?api=1&query=Union+Square+San+Francisco"}, {icon:"☕", label:"Coffee", url:"https://www.google.com/maps/search/?api=1&query=coffee+near+Union+Square+SF"}, {icon:"💊", label:"Pharmacy", url:"https://www.google.com/maps/search/?api=1&query=pharmacy+near+Union+Square+SF"}, {icon:"🌱", label:"Vegetarian", url:"https://www.google.com/maps/search/?api=1&query=vegetarian+food+near+Union+Square+SF"}, {icon:"🛍️", label:"Shopping", url:"https://www.google.com/maps/search/?api=1&query=shopping+near+Union+Square+SF"}, {icon:"🚕", label:"Uber", url:"https://m.uber.com/ul/"} ]
},
yosemite:{
name:"Yosemite", hero:"https://images.unsplash.com/photo-1516687401797-25297ff1462c?q=80&w=1740&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", dates:"23–26 Sep", area:"Yosemite Valley", lat:37.7456, lon:-119.5936,
stay:{ address: "Yosemite Valley Lodge, Yosemite National Park, CA 95389", mapsLink: "https://www.google.com/maps/search/?api=1&query=Yosemite+Valley+Lodge" },
food:[
{icon:"🍕", name:"Curry Village Pizza", desc:"Casual outdoor patio pies.", url:"https://www.google.com/maps/search/?api=1&query=Curry+Village+Pizza+Deck"},
{icon:"🍔", name:"Village Grill Deck", desc:"Classic grill fare with great views. Veggie burgers available.", url:"https://www.google.com/maps/search/?api=1&query=Village+Grill+Yosemite", veg:true},
{icon:"🏨", name:"The Ahwahnee Dining", desc:"Historic fine dining experience.", url:"https://www.google.com/maps/search/?api=1&query=The+Ahwahnee+Dining+Room"}
],
moments:[
{id:"stargazing", icon:"🌌", title:"Yosemite Stargazing", description:"Milky Way hunt from Glacier Point or Tunnel View."},
{id:"mistTrail", icon:"💦", title:"Hike the Mist Trail", description:"Get soaked by Vernal Fall."},
{id:"sequoias", icon:"🌲", title:"Mariposa Grove", description:"Walk among giant sequoias."},
{id:"tunnelViewSunset", icon:"🌅", title:"Tunnel View Sunset", description:"Watch the valley light up at golden hour."}
],
concierge:[ {icon:"🏔️", label:"Visitor Center", url:"https://www.google.com/maps/search/?api=1&query=Yosemite+Valley+Visitor+Center"}, {icon:"🥾", label:"Trail Maps", url:"https://www.nps.gov/yose/planyourvisit/maps.htm"}, {icon:"🚌", label:"Shuttle", url:"https://www.nps.gov/yose/planyourvisit/publictransportation.htm"}, {icon:"⛽", label:"Gas", url:"https://www.nps.gov/yose/planyourvisit/gas.htm"}, {icon:"🚗", label:"Roads", url:"https://www.nps.gov/yose/planyourvisit/conditions.htm"}, {icon:"📸", label:"Webcams", url:"https://www.nps.gov/yose/learn/photosmultimedia/webcams.htm"} ]
},
vegas:{
name:"Las Vegas", hero:"https://images.unsplash.com/photo-1583207884889-d79abf0d0aa3?q=80&w=1768&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", dates:"26 Sep–1 Oct", area:"The Strip", lat:36.1699, lon:-115.1398,
stay:{ address: "The Cosmopolitan of Las Vegas, 3708 S Las Vegas Blvd, Las Vegas, NV 89109", mapsLink: "https://www.google.com/maps/search/?api=1&query=The+Cosmopolitan+of+Las+Vegas" },
food:[
{icon:"🍽️", name:"Bacchanal Buffet", desc:"Caesars’ legendary mega buffet.", url:"https://www.google.com/maps/search/?api=1&query=Bacchanal+Buffet"},
{icon:"🌱", name:"Crossroads Kitchen", desc:"Upscale, popular plant-based dining.", url:"https://www.google.com/maps/search/?api=1&query=Crossroads+Kitchen+Las+Vegas", veg:true},
{icon:"🌮", name:"Tacos El Gordo", desc:"Famous Tijuana-style tacos.", url:"https://www.google.com/maps/search/?api=1&query=Tacos+El+Gordo+Las+Vegas"},
{icon:"🥩", name:"Gordon Ramsay Steak", desc:"High-end steakhouse experience.", url:"https://www.google.com/maps/search/?api=1&query=Gordon+Ramsay+Steak+Las+Vegas"}
],
moments:[
{id:"vegasNight", icon:"🎰", title:"Vegas Boys Night", description:"A celebratory night out exploring iconic bars and neon-lit streets."},
{id:"sphere", icon:"🌐", title:"MSG Sphere", description:"Arrive early, centre seats for full dome experience."},
{id:"hooverDam", icon:"🌊", title:"Hoover Dam", description:"Morning tour, Boulder City coffee stop."},
],
flights:[ { id: "flight02", route:"LAS → NYC", airline: "JetBlue", number:"B6 276", status:"Booked", departureTime: "2025-10-01T09:10:00-07:00", arrivalTime: "2025-10-01T17:18:00-04:00", checkinURL: "https://www.jetblue.com/checkin" } ],
concierge:[ {icon:"🎰", label:"Casinos", url:"https://www.google.com/maps/search/?api=1&query=casinos+Las+Vegas+Strip"}, {icon:"🍸", label:"Best Bars", url:"https://www.google.com/search?q=best+cocktail+bars+las+vegas"}, {icon:"🎭", label:"Shows", url:"https://www.google.com/search?q=las+vegas+shows+tickets"}, {icon:"🍽️",label:"Buffets", url:"https://www.google.com/search?q=best+buffets+las+vegas"}, {icon:"☀️", label:"Pool Parties", url:"https://www.google.com/search?q=las+vegas+day+clubs+pool+parties"}, {icon:"🚕", label:"Uber", url:"https://m.uber.com/ul/"} ]
},
nyc:{
name:"New York City", hero:"https://images.unsplash.com/photo-1570304816841-906a17d7b067?q=80&w=2064&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D", dates:"1–3 Oct", area:"Midtown", lat:40.7128, lon:-74.0060,
stay:{ address: "Arlo Midtown, 351 W 38th St, New York, NY 10018", mapsLink: "https://www.google.com/maps/search/?api=1&query=Arlo+Midtown+New+York" },
food:[
{icon:"🍕", name:"Joe’s Pizza", desc:"The quintessential NY slice.", url:"https://www.google.com/maps/search/?api=1&query=Joe%27s+Pizza+NYC"},
{icon:"🥙", name:"The Halal Guys", desc:"Famous street cart (falafel avail.)", url:"https://www.google.com/maps/search/?api=1&query=The+Halal+Guys", veg: true},
{icon:"🥯", name:"Russ & Daughters", desc:"Iconic bagels and lox.", url:"https://www.google.com/maps/search/?api=1&query=Russ+%26+Daughters"},
{icon:"🍜", name:"Ippudo", desc:"World-class ramen bowls.", url:"https://www.google.com/maps/search/?api=1&query=Ippudo+NYC"}
],
moments:[
{id:"broadway", icon:"🎭", title:"Broadway Show", description:"Matinee + dinner or late show + stroll."},
{id:"topOfRock", icon:"🏙️", title:"Top of the Rock", description:"Unbeatable skyline views."},
{id:"brooklynBridge", icon:"🌉", title:"Brooklyn Bridge Walk", description:"Iconic walk for incredible skyline views."},
],
flights:[ { id: "flight03", route:"NYC → LON", airline: "Virgin Atlantic", number:"VS 46", status:"Booked", departureTime: "2025-10-03T20:00:00-04:00", arrivalTime: "2025-10-04T08:00:00-00:00", checkinURL: "https://www.virginatlantic.com/gb/en/travel-information/check-in.html" } ],
concierge:[ {icon:"🚇", label:"Subway Map", url:"https://new.mta.info/map/5256"}, {icon:"🍕", label:"Best Pizza", url:"https://www.google.com/search?q=best+pizza+slice+nyc"}, {icon:"🎭", label:"Broadway", url:"https://www.broadway.com/"}, {icon:"🏛️", label:"Museums", url:"https://www.google.com/search?q=best+museums+in+nyc"}, {icon:"🍸", label:"Rooftops", url:"https://www.google.com/search?q=best+rooftop+bars+nyc"}, {icon:"🚕", label:"Uber", url:"https://m.uber.com/ul/"} ]
}
};
const momentData = {
ggSunrise:{ title:'Golden Gate Sunrise', description:'Catching the first light over the iconic bridge from the Marin Headlands. Remember to bring a wind-proof layer!', locations:[{name:'Battery Spencer', why:'The classic postcard view'}, {name:'Hawk Hill', why:'A higher, wider perspective'}],
tips: [
{ text: "The 'marine layer' (fog) is common. Check a live webcam before you go for the best chance of a clear view." },
{ text: "It's a clear morning! This is rare and perfect for photography.", condition: { code: [0, 1, 2] } },
{ text: "With dense fog, you might not see the bridge, but the moody atmosphere can still be very beautiful.", condition: { code: [45, 48] } }
]},
alcatraz:{ title:'Alcatraz Island Tour', description:'Explore the historic and infamous island prison in the San Francisco Bay. Book tickets well in advance!', locations:[{name:'Alcatraz Island', why:'Main prison tour'}, {name:'Pier 33 Alcatraz Landing', why:'Ferry departure point'}],
tips: [
{ text: "The audio tour is excellent and highly recommended to get the full story." },
{ text: "It's often much colder and windier on the island than in the city. Bring extra layers!" }
]},
cableCar:{ title:'Ride a Cable Car', description:"Experience San Francisco's iconic moving landmark and see the city from a unique angle.", locations:[{name:'Powell-Hyde Cable Car Line', why:'Most scenic route'}, {name:'Cable Car Museum', why:'See the giant winding wheels'}],
tips: [
{ text: "Hold on tight! Standing on the running boards offers the most thrilling experience." }
]},
muirWoods:{ title:'Walk with Giants', description:'A serene trip to Muir Woods National Monument to stand in awe of the coastal redwoods.', locations:[{name:'Muir Woods National Monument', why:'Main visitor trails'}, {name:'Muir Beach Overlook', why:'Stunning coastal views nearby'}]},
stargazing:{ title:'Yosemite Stargazing', description:'Witness the Milky Way in a certified dark sky park, far from city lights.', locations:[{name:'Glacier Point', why:'Panoramic sky with Half Dome'}, {name:'Tunnel View', why:'Iconic valley view, also great for stars'}]},
mistTrail:{ title:'Hike the Mist Trail', description:'A signature Yosemite hike to the base of the powerful Vernal Fall. Bring a poncho!', locations:[{name:'Vernal Fall Footbridge', why:'First great viewpoint'}, {name:'Top of Vernal Fall', why:'Feel the power (and spray)'}],
tips: [
{ text: "You WILL get wet from the waterfall's spray, even on a sunny day. Protect your electronics." },
{ text: "With recent rain, the stone steps can be very slippery. Take your time and use the handrails.", condition: { code: [61, 63, 65, 80] } }
]},
sequoias:{ title:'Mariposa Grove', description:'Walk among a forest of giant sequoia trees, some of the largest living things on Earth.', locations:[{name:'Grizzly Giant', why:'One of the largest trees'}, {name:'California Tunnel Tree', why:'The famous walk-through tree'}]},
tunnelViewSunset: { title:'Tunnel View Sunset', description:"Watch the last light of day paint El Capitan and Half Dome in incredible colors from this classic viewpoint.", locations:[{name:'Tunnel View, Yosemite', why:'The most famous viewpoint in the park'}]},
vegasNight:{ title:'Vegas Boys Night', description:"A celebratory night out exploring iconic bars and neon-lit streets.", locations:[{name:'The Chandelier Bar', why:'Cocktails inside a crystal masterpiece'},{name:'Fountains of Bellagio', why:'Classic Vegas spectacle'}, {name:'Fremont Street Experience', why:'Classic neon & live music'}]},
sphere:{ title:'MSG Sphere Experience', description:"An absolute must-see. The future of immersive entertainment. Arrive early for the full experience and aim for central seats.", locations:[{name:'MSG Sphere Las Vegas', why:'The main attraction'}]},
grandCanyon:{ title:'Grand Canyon Day Trip', description:'Take a helicopter from Las Vegas for a breathtaking flight over and into the West Rim, or take a scenic drive to the iconic South Rim for classic views.', locations:[{name:"Maverick Helicopters LV", why:"Departure for West Rim tours"}, {name:"Grand Canyon South Rim", why:"Drive for Mather Point vistas"}],
tips: [
{ text: "Book the first flight of the morning for the smoothest air and best light." },
{ text: "It's a brilliantly clear day. You'll have incredible visibility for miles!", condition: { code: [0, 1, 2] } },
{ text: "It's very hot today. Stay hydrated! Drink water even if you don't feel thirsty.", condition: { temp_gt: 30 } }
]},
hooverDam:{ title:'Hoover Dam Tour', description:"A morning tour to marvel at this incredible feat of modern engineering.", locations:[{name:'Hoover Dam', why:'Take the Power Plant or Full Dam Tour'}, {name:"Boulder City", why:"Historic town for a coffee stop"}]},
broadway:{ title:'Broadway Show', description:'A night of world-class theatre in the heart of Manhattan.', locations:[{name:'TKTS Ticket Booth Times Square', why:'Discounted same-day tickets'}, {name:'Broadway Theatre District', why:'The heart of it all'}]},
topOfRock:{ title:'Top of the Rock', description:'Get the best, unobstructed 360° views of the NYC skyline.', locations:[{name:'Top of the Rock Observation Deck', why:'The main viewpoint'}]},
brooklynBridge:{ title:'Brooklyn Bridge Walk', description:'The classic walk from Brooklyn to Manhattan offers unforgettable views of the city skyline. Go early to avoid crowds.', locations:[{name:"DUMBO - Washington Street", why:"Starting point for the classic photo"}, {name:"Brooklyn Bridge Pedestrian Walkway", why:'The walk itself'}],
tips: [
{ text: "Walk from the Brooklyn side towards Manhattan for the best skyline views." },
{ text: "It's raining, so the walkway might be less crowded, but watch your step on the wooden planks.", condition: { code: [61, 63, 65, 80] } }
]}
};

let currentCityId = 'sanfran';
let journeyHubInterval;
let weatherCache = new Map();
let currentUSDRate = null; // For currency converter

/* ========== INITIALIZATION ========== */
document.addEventListener('DOMContentLoaded', () => {
setupCountdown();
updateTimelineStatus();
observeScrollAnimations();
setupTripPlanner();
fetchCurrencyRate();
buildTabs();
switchCity(currentCityId, true);
updateJourneyHub(); // Initial call
if(journeyHubInterval) clearInterval(journeyHubInterval);
journeyHubInterval = setInterval(updateJourneyHub, 5000);
});

/* ========== CORE UI & LAYOUT ========== */
function setupCountdown() {
const tripDate = new Date('2025-09-19T09:00:00-07:00');
const countdownInterval = setInterval(() => {
const diff = tripDate.getTime() - new Date().getTime();
if (diff <= 0) {
document.querySelector('.countdown-container').innerHTML = `<div style="font-size:18px;font-weight:600;color:var(--success);">🎉 Adventure Time!</div>`;
clearInterval(countdownInterval);
return;
}
document.getElementById('days').textContent = String(Math.floor(diff / 864e5)).padStart(2,'0');
document.getElementById('hours').textContent = String(Math.floor((diff % 864e5) / 36e5)).padStart(2,'0');
document.getElementById('minutes').textContent = String(Math.floor((diff % 36e5) / 6e4)).padStart(2,'0');
document.getElementById('seconds').textContent = String(Math.floor((diff % 6e4) / 1e3)).padStart(2,'0');
}, 1000);
}

/* ===== Road Trip timeline status ===== */
function updateTimelineStatus(){
const el = document.getElementById('timelineStatus');
if(!el) return;
const start = new Date('2025-09-19T00:00:00-07:00');
const days = Math.ceil((start - new Date())/86400000);
el.textContent = days>0 ? `🛤️ ~${days} day${days!==1?'s':''} until your journey begins!`
: `🛤️ You're on the road — make it count!`;
}

function observeScrollAnimations() {
const observer = new IntersectionObserver((entries) => {
entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
}, { threshold: 0.1 });
document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
}
function setupTripPlanner() {
const track = document.getElementById('tip-track');
const dotsContainer = document.getElementById('planner-dots');
if (!track || !dotsContainer) return;
const slides = Array.from(track.children);
let currentIndex = 0;
let autoPlayInterval = setInterval(() => goToSlide((currentIndex + 1) % slides.length), 5000);
slides.forEach((_, i) => {
const dot = document.createElement('button');
dot.classList.add('dot');
if (i === 0) dot.classList.add('active');
dot.setAttribute('aria-label', `Go to tip ${i + 1}`);
dot.addEventListener('click', () => {
goToSlide(i);
clearInterval(autoPlayInterval);
autoPlayInterval = setInterval(() => goToSlide((currentIndex + 1) % slides.length), 5000);
});
dotsContainer.appendChild(dot);
});
const dots = Array.from(dotsContainer.children);
const goToSlide = (index) => {
track.style.transform = `translateX(-${index * 100}%)`;
dots.forEach((d, i) => d.classList.toggle('active', i === index));
currentIndex = index;
};
}
// ENHANCED: Live currency API function
async function fetchCurrencyRate() {
try {
const response = await fetch('https://open.er-api.com/v2/latest/GBP');
if (!response.ok) throw new Error('Network response was not ok');
const data = await response.json();
currentUSDRate = data.rates.USD;

const lastUpdated = new Date(data.time_last_update_unix * 1000);
document.getElementById('currency-rate').textContent = `£1 = $${currentUSDRate.toFixed(4)}`;
document.getElementById('currency-rate-sub').textContent = `Live Rate (Last updated: ${lastUpdated.toLocaleTimeString()})`;

document.getElementById('currency-input').addEventListener('input', (e) => updateCurrencyConversion(e.target.value));
document.querySelectorAll('.quick-convert-btn').forEach(btn => {
btn.addEventListener('click', () => {
const amount = btn.dataset.amount;
document.getElementById('currency-input').value = amount;
updateCurrencyConversion(amount);
});
});

renderCurrencyChart();

} catch (error) {
console.error('Failed to fetch currency rate:', error);
document.getElementById('currency-rate').textContent = '£1 = $--.--';
document.getElementById('currency-rate-sub').textContent = 'Could not fetch live rate.';
}
}
function updateCurrencyConversion(amount) {
const resultEl = document.getElementById('conversion-result');
if (currentUSDRate && amount) {
const amountGBP = parseFloat(amount);
const amountUSD = (amountGBP * currentUSDRate).toFixed(2);
resultEl.textContent = `≈ $${amountUSD}`;
resultEl.classList.add('visible');
} else {
resultEl.classList.remove('visible');
}
}
function renderCurrencyChart() {
// Generates a random-looking path for visual effect
let d = "M0,40";
for (let i = 1; i <= 10; i++) {
const x = i * 30;
const y = 20 + Math.random() * 40;
d += ` L${x},${y}`;
}
document.getElementById('sparkline-path').setAttribute('d', d);
}
function buildTabs() {
const container = document.getElementById('tabs');
container.innerHTML = Object.keys(cities).map((id, i) =>
`<button role="tab" aria-selected="${i===0}" class="tab ${i===0?'active':''}" data-city="${id}">${cities[id].name}</button>`
).join('');
container.addEventListener('click', e => { if (e.target.matches('.tab')) switchCity(e.target.dataset.city); });
}
function switchCity(cityId, isInitial = false) {
currentCityId = cityId;
const city = cities[cityId];
const card = document.getElementById('main-card');
const updateContent = () => {
document.getElementById('hero-image').style.backgroundImage = `url('${city.hero}')`;
document.getElementById('hero-title-text').textContent = city.name;
document.getElementById('hero-area').textContent = city.area;
const foodHtml = city.food?.length > 0 ? `<div class="widget"><h3>Good Food Spots</h3><div class="widget-list">${city.food.map(item => `<a class="widget-item a" href="${item.url}" target="_blank" rel="noopener"><div class="widget-icon">${item.icon}</div><div class="widget-text"><h4>${item.name} ${item.veg ? '<span style="color:var(--success);font-size:12px;">🌱</span>' : ''}</h4><p>${item.desc}</p></div></a>`).join('')}</div></div>` : '';
document.getElementById('content-column').innerHTML = `<div style="background:var(--surface);padding:16px;border-radius:var(--radius-lg);"><div class="info-item"><span>Dates</span><span>${city.dates}</span></div><div class="info-item"><span>Area</span><span>${city.area}</span></div></div><div class="widget" style="cursor:pointer;" id="weather-widget"><h3>Live Weather</h3><div class="weather-main"><div class="weather-icon">⏳</div><div><div class="weather-temp">--°C</div><div class="weather-desc">Loading...</div></div></div></div>${foodHtml}`;
renderWeather(cityId);
renderDynamicSections(cityId);
document.querySelectorAll('.tab').forEach(t => {
const isActive = t.dataset.city === cityId;
t.classList.toggle('active', isActive);
t.setAttribute('aria-selected', isActive);
});
card.classList.add('visible');
};
if (isInitial) {
updateContent();
} else {
card.classList.remove('visible');
setTimeout(updateContent, 300);
}
}
function renderDynamicSections(cityId) {
const city = cities[cityId];

const momentsSection = document.getElementById('dynamic-moments-section');
const momentsGrid = document.getElementById('dynamic-moments-grid');
if (city.moments?.length > 0) {
momentsSection.style.display = 'block';
momentsGrid.innerHTML = city.moments.map(moment => `<article class="moment-card" onclick="openCustomModal('${moment.id}')"><div class="moment-header"><div class="moment-icon">${moment.icon}</div><h3 class="moment-title">${moment.title}</h3></div><p class="moment-description">${moment.description}</p></article>`).join('');
} else {
momentsSection.style.display = 'none';
}

const flightsSection = document.getElementById('dynamic-flights-section');
const flightsList = document.getElementById('dynamic-flights-list');
const cityFlights = city.flights || [];

if (cityFlights.length > 0) {
flightsSection.style.display = 'block';
flightsList.innerHTML = cityFlights.map(flight => `<article class="flight-card" id="${flight.id}" data-departure-time="${flight.departureTime}" data-arrival-time="${flight.arrivalTime}" data-checkin-url="${flight.checkinURL}"></article>`).join('');
updateJourneyHub();
} else {
flightsSection.style.display = 'none';
}
}

/* ========== INTERACTIVITY HOOKS FOR NEW MAP ========== */
function showLocationDetails(cityId) {
const hub = document.getElementById('destinations-hub');
if(hub) {
hub.scrollIntoView({ behavior: 'smooth', block: 'start' });
}
setTimeout(() => {
switchCity(cityId);
}, 300);
}
function showMomentDetails(momentId) {
openCustomModal(momentId);
}

/* ========== JOURNEY HUB LOGIC ========== */
function getFlightById(flightId) {
for (const cityId in cities) {
const flight = cities[cityId].flights?.find(f => f.id === flightId);
if (flight) return { flight, city: cities[cityId] };
}
return null;
}
function getDestinationCityByFlight(flight) {
const destinationCode = flight.route.split(' → ')[1];
const cityMap = { SFO: 'sanfran', YOS: 'yosemite', LAS: 'vegas', NYC: 'nyc' };
for (const code in cityMap) {
if (destinationCode.includes(code)) return cities[cityMap[code]];
}
return null;
}
function formatTimeDiff(diffMs) {
diffMs = Math.max(0, diffMs);
const h = Math.floor(diffMs / 36e5), m = Math.floor((diffMs % 36e5) / 6e4), s = Math.floor((diffMs % 6e4) / 1e3);
return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
}
function updateJourneyHub() {
const now = new Date();

document.querySelectorAll('.flight-card').forEach(cardEl => {
const flightData = getFlightById(cardEl.id);
if (!flightData) return;

const { flight } = flightData;
const departureTime = new Date(flight.departureTime);
const arrivalTime = new Date(flight.arrivalTime);
const hoursUntilDeparture = (departureTime - now) / 3600000;
const destinationCity = getDestinationCityByFlight(flight);

let currentState = 'default';
if (now > arrivalTime) {
currentState = (now - arrivalTime) > 24 * 3600000 ? 'archived' : 'post-flight';
} else if (hoursUntilDeparture <= 6) {
currentState = 'pre-flight';
} else if (hoursUntilDeparture <= 24) {
currentState = 'get-ready';
}

const defaultHTML = `<div class="flight-card-content"><div class="flight-header"><div class="flight-route">${flight.route}</div><div class="flight-date">${new Date(flight.departureTime).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div></div><div class="flight-details"><div><div class="detail-label">Flight</div><div class="detail-value">${flight.airline} ${flight.number}</div></div><div><div class="detail-label">Status</div><div class="flight-status">${flight.status}</div></div></div></div>`;
let contentHTML = defaultHTML;
cardEl.className = 'flight-card default';

if (currentState === 'get-ready') {
cardEl.className = 'flight-card get-ready';
contentHTML = `${defaultHTML}<div class="flight-card-content" style="border-top: 1px solid var(--separator); padding-top: 16px;"><a href="${flight.checkinURL}" target="_blank" rel="noopener" class="journey-btn primary">✈️ Online Check-In</a></div>`;
} else if (currentState === 'pre-flight') {
cardEl.className = 'flight-card travel-day';
contentHTML = `<div class="flight-card-content"><div class="flight-header"><div class="flight-route">${flight.route}</div></div><div class="journey-countdown"><div class="countdown-title">Departs In</div><div class="countdown-time">${formatTimeDiff(departureTime - now)}</div></div><div class="journey-actions"><a href="#" class="journey-btn">📄 Boarding Pass</a><a href="https://www.google.com/maps/dir/?api=1&destination=${flight.route.split('→')[0].trim()}+Airport" target="_blank" class="journey-btn">🚗 To Airport</a></div></div>`;
} else if (currentState === 'post-flight' && destinationCity) {
cardEl.className = 'flight-card travel-day';
contentHTML = `<div class="flight-card-content"><div class="handoff-welcome"><div class="handoff-title">Welcome to ${destinationCity.name}!</div><div class="handoff-subtitle">Your adventure continues.</div></div><div class="handoff-address"><strong>Your Next Stay</strong><span>${destinationCity.stay.address}</span></div><a href="${destinationCity.stay.mapsLink}" target="_blank" rel="noopener" class="journey-btn primary">🗺️ Navigate to Your Stay</a></div>`;
} else if (currentState === 'archived') {
cardEl.className = 'flight-card archived';
contentHTML = `<div class="flight-card-content" style="opacity: 0.7;"><div class="flight-header"><div class="flight-route">✅ ${flight.route}</div><div class="flight-date">${new Date(flight.departureTime).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div></div><div style="font-size: 14px; color: var(--text-secondary); padding-top: 8px;">Journey complete.</div></div>`;
}
cardEl.innerHTML = contentHTML;
});
}

/* ========== WEATHER & MODALS ========== */
async function fetchWeather(city) {
const cache = weatherCache.get(city.name);
if (cache && (Date.now() - cache.ts) < 900000) return cache.data;
const url = `https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current=temperature_2m,apparent_temperature,relative_humidity_2m,weather_code,wind_speed_10m,precipitation_probability&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min,weather_code&windspeed_unit=kmh&timezone=auto&forecast_days=7`;
try {
const res = await fetch(url);
const data = await res.json();
weatherCache.set(city.name, { data, ts: Date.now() });
return data;
} catch (e) { return null; }
}
async function renderWeather(cityId) {
const city = cities[cityId];
const widget = document.getElementById('weather-widget');
if (!widget) return;
const data = await fetchWeather(city);
if (!data) { widget.querySelector('.weather-desc').textContent = "Failed to load"; return; }
widget.querySelector('.weather-icon').textContent = wmoIcon(data.current.weather_code);
widget.querySelector('.weather-temp').textContent = `${Math.round(data.current.temperature_2m)}°C`;
widget.querySelector('.weather-desc').textContent = weatherDescriptions[data.current.weather_code] || 'Clear';
widget.onclick = () => openWeatherDetail(city, data);
}
function openWeatherDetail(city, data) {
const { current, hourly, daily } = data;
const type = wmoAnimType(current.weather_code);
document.getElementById('wx-sheet').className = `wx-sheet wx-${type}`;
document.getElementById('wx-anim-detail').innerHTML = wmoAnimHTML(type);
document.getElementById('wx-city').textContent = city.name;
document.getElementById('wx-temp-lg').textContent = `${Math.round(current.temperature_2m)}°`;
document.getElementById('wx-desc-lg').textContent = weatherDescriptions[current.weather_code] || 'Clear';
document.getElementById('wx-feels').textContent = `${Math.round(current.apparent_temperature)}°`;
document.getElementById('wx-hum').textContent = `${current.relative_humidity_2m}%`;
document.getElementById('wx-wind').textContent = `${Math.round(current.wind_speed_10m)} km/h`;
document.getElementById('wx-rain').textContent = `${current.precipitation_probability}%`;
const startIndex = hourly.time.findIndex(t => new Date(t) > new Date());
document.getElementById('wx-hourly-cards').innerHTML = hourly.time.slice(startIndex, startIndex + 8).map((time, i) => `<div class="wx-hour"><div>${new Date(time).getHours()}:00</div><div style="font-size:22px;margin:4px 0">${wmoIcon(hourly.weather_code[startIndex+i])}</div><div class="t">${Math.round(hourly.temperature_2m[startIndex+i])}°</div></div>`).join('');
document.getElementById('wx-days-cards').innerHTML = daily.time.slice(0, 3).map((date, i) => `<div class="wx-day"><div>${new Date(date).toLocaleDateString('en-US', {weekday:'short'})}</div><div style="font-size:22px;margin:6px 0">${wmoIcon(daily.weather_code[i])}</div><div><span class="hi">${Math.round(daily.temperature_2m_max[i])}°</span>/<span class="lo">${Math.round(daily.temperature_2m_min[i])}°</span></div></div>`).join('');
toggleWx(true);
}
function toggleWx(open) {
document.getElementById('wx-overlay').classList.toggle('show', open);
document.body.style.overflow = open ? 'hidden' : '';
}
function toggleConcierge() {
const overlay = document.getElementById('concierge-overlay');
const isOpen = overlay.classList.contains('show');
if (!isOpen) {
const city = cities[currentCityId];
document.getElementById('concierge-title').textContent = `${city.name} Concierge`;
document.getElementById('quick-actions').innerHTML = city.concierge.map(a => `<a class="quick-action" href="${a.url}" target="_blank" rel="noopener"><div class="icon">${a.icon}</div><div class="label">${a.label}</div></a>`).join('');
}
overlay.classList.toggle('show');
document.body.style.overflow = isOpen ? '' : 'hidden';
}
function getCityIdForMoment(momentId) {
for (const cityId in cities) {
if (cities[cityId].moments && cities[cityId].moments.some(m => m.id === momentId)) {
return cityId;
}
}
// Fallback for Grand Canyon as a special case not tied to a main city object
if (momentId === 'grandCanyon') return 'vegas';
return null;
}
async function openCustomModal(id) {
const data = momentData[id];
if(!data) return;

const cityId = getCityIdForMoment(id);
const city = cities[cityId];
if(!city) return;

document.getElementById('modalTitleCustom').textContent = data.title;
let bodyHTML = `
<p style="color:var(--text-secondary); line-height:1.6; margin-bottom: 24px;">${data.description}</p>
<h4 style="font-size: 16px; font-weight: 600; margin-bottom:12px;">📍 Key Locations & Notes</h4>
${data.locations.map(loc => `<div class="modal-list-item"><div class="modal-item-text"><strong>${loc.name}</strong><span>${loc.why}</span></div><a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(loc.name)}" target="_blank" class="modal-item-action">Map</a></div>`).join('')}
<div id="live-tips-container"></div>`;
document.getElementById('modalBodyCustom').innerHTML = bodyHTML;
document.getElementById('modalOverlayCustom').classList.add('show');
document.body.style.overflow = 'hidden';

const tipsContainer = document.getElementById('live-tips-container');
tipsContainer.innerHTML = '<div class="live-tip">Fetching live tips...</div>'; // Placeholder

const weatherData = await fetchWeather(city); // Fetch weather for the base city (Vegas)
let liveTipsHtml = '';
if (weatherData && data.tips) {
const current = weatherData.current;
const liveTips = data.tips.filter(tip => {
if (!tip.condition) return true;
const codeMatch = tip.condition.code && tip.condition.code.includes(current.weather_code);
const tempMatch = tip.condition.temp_gt && current.temperature_2m > tip.condition.temp_gt;
return codeMatch || tempMatch;
});
if(liveTips.length > 0) {
liveTipsHtml = `<h4 style="font-size: 16px; font-weight: 600; margin-top:24px; margin-bottom:12px;">💡 Live Tips</h4>` +
liveTips.map(tip => `<div class="live-tip">${tip.text}</div>`).join('');
tipsContainer.innerHTML = liveTipsHtml;
} else {
tipsContainer.innerHTML = ''; // Clear if no tips
}
} else {
tipsContainer.innerHTML = ''; // Clear if no weather data or tips
}
}
function closeCustomModal() {
document.getElementById('modalOverlayCustom').classList.remove('show');
document.body.style.overflow = '';
}

/* ========== BIRTHDAY & SLOT MACHINE ========== */
const slotSymbols = ['💎', '🍒', '7️⃣', '🎰', '🔔'];
let isSpinning = false;

function playSlots() {
if (isSpinning) return;
isSpinning = true;
const container = document.getElementById('slotMachineContainer');
container.classList.add('visible');
const reels = [document.getElementById('reel1'), document.getElementById('reel2'), document.getElementById('reel3')];
const results = reels.map(() => slotSymbols[Math.floor(Math.random() * slotSymbols.length)]);

reels.forEach((reel, i) => {
const strip = Array.from({ length: 30 }, () => slotSymbols[Math.floor(Math.random() * slotSymbols.length)]);
strip[strip.length - 2] = results[i]; // Set the final symbol
reel.innerHTML = strip.map(symbol => `<span>${symbol}</span>`).join('');

reel.style.transition = 'none';
reel.style.transform = 'translateY(0)';
void reel.offsetHeight; // Trigger reflow

const finalPosition = (strip.length - 2) * 100;
reel.style.transition = `transform ${2500 + i * 500}ms cubic-bezier(0.25, 0.1, 0.25, 1)`;
reel.style.transform = `translateY(-${finalPosition}px)`;
});

setTimeout(() => {
const isWin = results.every(val => val === results[0]);
if (isWin) {
celebrateBirthday();
} else {
const wittyLossMessages = [
"Almost! The house always has an edge.",
"Not quite! Maybe try blowing on the screen first?",
"So close! Are you sure you're feeling lucky?",
"Swing and a miss! The slots are fickle.",
"Better luck next time! Vegas wasn't built in a day.",
"That's not it. Try channeling your inner high-roller."
];
const randomMessage = wittyLossMessages[Math.floor(Math.random() * wittyLossMessages.length)];
showVegasToast('😂', randomMessage);
}
isSpinning = false;
}, 3500);
}

function celebrateBirthday() {
triggerJackpotConfetti();
showVegasToast('🎉', 'JACKPOT! Happy Birthday!');
if (navigator.vibrate) navigator.vibrate([200, 100, 200]);
}

function triggerJackpotConfetti() {
const canvas = document.getElementById('vegasConfettiCanvas');
if (!canvas) return;
const ctx = canvas.getContext('2d');
canvas.width = canvas.parentElement.offsetWidth;
canvas.height = canvas.parentElement.offsetHeight;
const particles = [];
const colors = ['#FFD700', '#FF1493', '#00F5FF'];
const emojis = ['💰', '🎰', '💎', '🎉'];
for (let i = 0; i < 150; i++) particles.push({ x: canvas.width/2, y: canvas.height, vx: (Math.random()-0.5)*10, vy: -Math.random()*15-5, size: Math.random()>0.8?24:Math.random()*8+4, color: colors[Math.floor(Math.random()*colors.length)], emoji: Math.random()>0.8?emojis[Math.floor(Math.random()*emojis.length)]:null, opacity:1, gravity:0.2 });
function animateConfetti() {
ctx.clearRect(0, 0, canvas.width, canvas.height);
particles.forEach((p, i) => {
p.vy+=p.gravity; p.x+=p.vx; p.y+=p.vy; p.opacity-=0.005; ctx.globalAlpha=p.opacity;
if (p.emoji) { ctx.font=`${p.size}px Arial`; ctx.fillText(p.emoji,p.x,p.y); }
else { ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,p.size,p.size); }
if (p.opacity<=0) particles.splice(i,1);
});
if (particles.length > 0) requestAnimationFrame(animateConfetti);
}
animateConfetti();
}

function showVegasToast(icon, message) {
const existing = document.querySelector('.vegas-toast');
if(existing) existing.remove();
const toast = document.createElement('div');
toast.className = 'vegas-toast';
toast.innerHTML = `<span style="font-size:24px">${icon}</span><span>${message}</span>`;
document.body.appendChild(toast);
setTimeout(() => toast.classList.add('show'), 10);
setTimeout(() => {
toast.classList.remove('show');
toast.addEventListener('transitionend', () => toast.remove());
}, 3000);
}

/* ========== UTILITY MAPPING ========== */
const wmoIcon = (code) => ({0:"☀️",1:"🌤️",2:"⛅",3:"☁️",45:"🌫️",48:"🌫️",61:"🌦️",63:"🌧️",65:"🌧️",80:"🌧️",95:"⛈️", 51: "🌦️", 53: "🌦️", 55: "🌦️"}[code] || "🌡️");
const wmoAnimType = (code) => ({0:"sunny",1:"cloudy",2:"cloudy",3:"cloudy",45:"cloudy",48:"cloudy",61:"rainy",63:"rainy",65:"rainy",80:"rainy",95:"rainy", 51: "rainy", 53: "rainy", 55: "rainy"}[code] || "cloudy");
const wmoAnimHTML = (type) => type === "rainy" ? Array.from({length:32}).map(()=>`<div class="rain-drop" style="left:${Math.random()*100}%; top:${Math.random()*80}%; animation-delay:${(Math.random()*1.2).toFixed(2)}s; animation-duration:${(0.7+Math.random()*0.7).toFixed(2)}s"></div>`).join('') : "";
const weatherDescriptions = {0:"Clear",1:"Mainly Clear",2:"Partly Cloudy",3:"Overcast",45:"Fog",48:"Rime Fog",51:"Light Drizzle",53:"Drizzle",55:"Heavy Drizzle",61:"Slight Rain",63:"Rain",65:"Heavy Rain",80:"Showers",95:"Thunderstorm"};
</script>
</body>
</html>
